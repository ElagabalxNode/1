---
- name: "Upload keys: Build flat keys path"
  set_fact:
    secrets_local_path: "{{ local_secrets_path }}"
  when: flat_path|bool

- name: "Upload keys: Check validator-keypair exists locally"
  stat:
    path: "{{ secrets_local_path }}/neonevm-keypair.json"
  connection: local
  become: no
  delegate_to: localhost
  register: operator_keypair_exists
  tags:
    - validator.manage.keys.create.vote
  when: not fail_if_no_validator_keypair

- name: "Upload keys: upload validator-keypair"
  copy:
    src: "{{ secrets_local_path }}/neonevm-keypair.json"
    dest: "{{ secrets_path }}"
    mode: 0400
    owner: "{{ neonevm_user }}"
    group: "{{ neonevm_user }}"
    force: false
  tags:
    - validator.manage.keys.upload
  when: fail_if_no_validator_keypair
     or validator_keypair_exists.stat.exists

