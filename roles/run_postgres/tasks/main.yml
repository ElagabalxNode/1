--- 

- name: Create the database specified in vars
  become: true
  become_user: postgres
  postgresql_db: 
    name: "{{ postgres_db }}"
    template: "'template0"
    state: present

- name: User fot
  become: true
  become_user: postgres
  postgresql_user: 
    db: "{{ postgres_db }}"
    name: "{{ postgres_user }}"
    password: "{{ postgres_password }}"
    priv: ALL
    state: present

- name: Ensure user does not have unnecessary permissions
  become: true
  become_user: postgres
  postgresql_user: 
    name: "{{ postgres_user }}"
    role_attr_flags: NOSUPERUSER,NOCREATEDB
    state: present